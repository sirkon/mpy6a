# Репликация данных

Репликация 

* Осуществляется через соединения между узлами кластера, при этом выделяется "лидер" и "последователи", где
каждый узел знает как свою роль, так и роли остальных узлов. Такая функциональность обеспечивается реализацией 
протокола достижения консенсуса RAFT.
* Реализуется выполнением команд репликации. 

## Команды репликации

Каждая команда имеет параметр ID — её идентификатор, это уникальная величина типа uint128 (16 байт), причём 
идентификатор каждой последующей команды строго **БОЛЬШЕ** чем у текущей.

| Название       | Параметры     | Описание                                                                           |
|----------------|---------------|------------------------------------------------------------------------------------|
| Confirm        | ID            | Подтверждение выполнения команды.                                                  |
| SessionCreate  | ID, topic     | Создание сессии чей идентификатор совпадает с идентификатором команды.             |
| SessionAppend  | ID, bytes     | Добавить в сессию новую запись.                                                    |
| SessionRewrite | ID, bytes     | Замена содержимого сессии на новое.                                                |
| SessionStore   | ID            | Сохранить данную сессию с нужными (вычисляемыми) параметрами — время повтора и пр. |
| SessionDestroy | ID            | Удалить сессию.                                                                    |
| SessionRestore | FileName, Len | Прочесть сессию из данного файла и сделать её активной.                            |
| SessionCommit  | FileName, Len | Подтвердить прочтение сессии.                                                      |
| DataCreate     | ID, Replay    | Создать новый файл для данных с указанным повтором.                                |
| DataDelete     | OldID, Replay | Удалить файл созданный с данным OldID и Replay.                                    |

### Замечания

* Команды протокола репликации ходят только между лидером и последователем.
* Все команды, кроме `Confirm`, идут от лидера к последователям.
* Команда `Confirm` отправляется только последователем лидеру.

