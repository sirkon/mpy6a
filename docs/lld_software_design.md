# LLD по устройству сервиса.

В этом материале будет описана реализация сервиса с разделением на компоненты отвечающие за конкретную
функциональность.

## Хранение данных.

За хранение данных отвечает компонент `Storage`, который реализует следующую функциональность:

* Файловые операции, такие как
  * Создание файлов.
  * Удаление файлов.
  * Ведение списка файлов с добавлением и выбыванием оттуда старых записей относящихся к давно не используемым файлам.
  * Удаление файлов не входящих в список.
* Работа с логом операций.
* Работа с логом слепков.
* Создание слепков текущего состояния хранилища.
* Слияние файлов с сессиями.
* Сохранение активных сессий в память либо в файлы с фиксированным временем повтора.
* CRUD над активными сессиями.
* Отдача курсора по сохранённым сессиями для их повтора по наступлению времени.

## Реализация RAFT.

За реализацию RAFT отвечает компонент `RAFT`, который реализует (слегка расширенную по сравнению с канонической версией)
данный протокол, включая транспорт.

## Реализация состояния.

Состояние реализуется компонентом `State` который оперирует сущностями `Storage` и `Raft`.

## Реализация сервиса.

Реализация сервиса выполняется пользователем библиотеки и должна включать в себя:

* Задание конфигурации сервиса.
* Реализацию "service discovery" каким-нибудь способом.
* Инициализацию компонентов `Storage` и `Raft`.
* Инициализацию компонента `State`.
* RPC-ручки оперирующие методами `State`.
* Фоновые процессы:
  * Повторы сессий.
  * Периодическая чистка данных (файлы).
  * Периодическая ротация обоих видов логов.
  * Периодическое слияние файлов.
  * Запуск создания слепков когда выполняются критерии необходимости этой операции 
    (большой объём сохраненных в память сессий).
* Реализация логирования.