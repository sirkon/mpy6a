# Постановка задачи.

Требуется реализовать машину состояний пригодную для реализации:

1. Распределённого **WAL** – **W**rite **A**head **L**og.
2. Распределённого Cron-сервиса.
3. Распределённого сервиса постановки единоразовых задач, т.е. задач которые нужно выполнить в определённое время ровно
   один раз, без повторения как в случае с кроном. Некий аналог `at`. Является, по-сути, тривиальным расширением
   пункта 2.

## Типичные сценарии использования WAL.

1. Создание сессии WAL.
2. Модификация записей в сессии – можно добавлять новые данные или замещать текущие данные новыми.
3. Закрытие (удаление) сессии.
4. Сохранение сессии для повтора через N секунд. При этом ожидается, что некоторые из таких величин N будут очень 
   популярными. До такой степени, что стоит обратить на это внимание при выборе подхода к хранилищу.

Кроме этого есть т.н. "восстановление" или "повтор" сессии:

* Некий обработчик получает на вход набор сохранённых данных сессии и ручку для управления ею, с помощью которой
  он может выполнять операции 2-4 описанные выше.

## Cценарий использования cron.

1. Создание крон-задачи с некоторым шаблоном времени.
2. Нахождение ближайшего срока выполнения T – в секундах.
3. Сохранение задачи с повтором после T-ой секунды.

Так же:

* При "восстановлении" крон-задачи:

1. Сразу же сохраняем её для последующего повтора в следующий момент времени по шаблону – если такое есть.
   Если нет, то удаляем задачу.
2. Выполняем задачу по её данным.

Для этой задачи потребуется вспомогательное хранилище, скорее всего какая-то сторонняя БД, для хранения метаданных.

## Сценарий использования at.

Аналогично cron, но только шаблон будет фиксированным, что исключает повтор более одного раза.